#!/bin/sh
#
#  $Id$

# enable HTTP requests on port 80
set port="-a 80"

PATH=@prefix@/bin:/bin
export PATH

if test $#argv = 1 ; then
	conf="-f $1"
	shift;
fi

failcount=0
while test 1 ; do
	echo "Running: squid $port -s $conf >> squid.out 2>&1"
	start=`date '+%d%H%M%S'`
	squid $port -s $conf >> squid.out 2>&1
	stop=`date '+%d%H%M%S'`
	t=`expr $stop - $start`
	if test 0 -le $t -a $t -lt 5 ; then
		failcount=`expr $failcount + 1`
	else
		failcount=0
	fi
	if test $failcount -gt 5 ; then
		echo "RunCache: EXITING DUE TO REPEATED, FREQUENT FAILURES"
		exit 1
	fi
	sleep 10
done
