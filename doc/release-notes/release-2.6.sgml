<!doctype linuxdoc system>
<article>
<title>Squid 2.6.STABLE1 release notes</title>
<author>Squid Developers</author>
<date>$Id$</date>

<abstract>
This document contains the release notes for version 2.6 of Squid.
Squid is a WWW Cache application developed by the Web Caching community.
</abstract>

<toc>

<sect>Key changes from squid 2.5
<p>
<itemize>
<item>Major improvements to the way that Squid handles web proxy, accelerated 
and transparent proxy requests to make it easier to configure transparent and 
acceleration functionality.  The default behaviour is to function as a standard 
HTTP proxy on each port that Squid is configured to listen on, but in addition 
in this release the keywords "accelerated" and "transparent" can be specified 
after each port to indicate to Squid the functionality that is to be enabled on 
that port.  This means that the old config directives relating to httpd_accel_* 
are now deprecated.
<item>WCCPv2 support multiple cache engines registering with multiple WCCP 
routers and switches.  WCCPv2 is preferred over WCCPv1 for performance and 
flexibility reasons if your router or switch is able to support it (all recent 
versions of IOS do so).  Initially WCCPv2 under Linux is limited to registration 
with only one router due to kernel limitations in more recent versions, although 
this will be addressed in a future release of Squid.
<item>TPROXY totally transparent proxy support under Linux, which to allow Squid 
to appear totally invisible to both client and server systems when transparently 
caching requests.  This works by spoofing the source and destination address to 
both the client and server.
<item>Support for Etag and Vary HTTP headers.  This further moves Squid towards 
HTTP/1.1 compliance.  The Vary header field is used for improved caching and 
delivery of customized content to end clients, and the Etag is used similar to 
an MD5 checksum between client and server to determine if a web page has changed 
since it was last retrieved.
<item>Collapsed forwarding, which gives Squid the ability to intelligently merge 
client requests for objects into one request to the server.  Of particular 
benefit in accelerator setups but also provides some benefits to non accelerator 
setups.
<item>Support for epoll under Linux and kqueue under FreeBSD, which gives Squid
the ability to handle many many more concurrent requests with lower CPU
overhead. This feature is of particular benefit to very busy caches 
as the poll() and select() routines do not scale anywhere near as well as epoll 
and kqueue does under high loads.
<item>SSL assisted hardware encryption making use of OpenSSL functionality 
within Squid.
<item>Logging enhancements to allow even greater customization of the way Squid 
logs requests in the access-log or to syslog if required
<item>Authentication enhancements including Negotiate/Kerberos support, extra
workarounds for NTLM clients and others using Microsoft Integrated Login.
<item>Additional external_acl parameters to support SSL and even more client 
side parameters.
<item>ACL changes in conjunction with SSL changes which have been merged, to 
allow matching based on SSL certificate parameters.
<item>Improvements to Cygwin support for users who wish to run Squid in a 
Microsoft Windows/Cygwin environment as a system service.
<item>New authentication helpers:
<itemize>
<item>Digest LDAP helper
<item>Native Windows basic, NTLM and negotiate helpers
<item>External acl helpers for session monitoring and native Windows group
membership check
</itemize>
<item>HTCP significantly cleaned up and added support for the CLR operation to purge contents from the cache
<item>Support for parsing X-Forwarded-For headers allowing access controls to be based on the real client IP even if behind secondary proxies
</itemize>

<sect>Changes to squid.conf
<p><descrip>
<tag>http_port</tag>Now takes a list of options in addition to the port address, specifying the purpose of this http_port. Default is plain Internet proxy as usual.
<tag>httpd_accel_* for transparent proxy</tag>Now implemented by the "transparent" http_port option
<tag>httpd_accel_host</tag>Replaced by defaultsite http_port option and cache_peer originserver option.
<tag>httpd_accel_port</tag>No longer needed. Server port defined by the cache_peer port.
<tag>httpd_accel_uses_host_header</tag>Replaced by vhost http_port option
<tag>https_port</tag>Many new options. Reconstructs URLs as https:// by default.
<tag>cache_peer</tag>Many new options to support origin servers and SSL encryption
<tag>ssl_engine</tag>New directive for hardware assisted SSL encryption
<tag>sslproxy_*</tag>New directives defining how to gateway http-&gt;https
<tag>sslpassword_program</tag>New helper directive to query an external program for SSL key encryption password (if any)
<tag>no_cache</tag>Renamed to cache to better reflect the functionaliy. no_cache still accepted.
<tag>cache</tag>New name for the old no_cache directive.
<tag>cache_vary</tag>New directive to disable caching of Vary:ing responses
<tag>broken_vary_encoding</tag>New directive to work around known broken compression modules which hasn't understood the meaning of the ETag HTTP header in relation to Accept-Encoding.
<tag>logformat</tag>New directive for defining custom log formats
<tag>cache_access_log</tag>Renamed to access_log
<tag>access_log</tag>Select what requests to log where any by what format. Support for multiple log files and multiple log formats.
<tag>check_hostnames</tag>New option to disable the hostname validity/sanity checks usually performed by Squid, replacing the similar build time configure option in 2.5.
<tag>allow_underscore</tag>New option to allow _ in hostnames, replacing the similar build time configure option in 2.5 and earlier.
<tag>dns_defnames</tag>Allow for domain searches. Now possible even when using the internal DNS client
<tag>redirect_*</tag>Renamed to url_rewrite_* to better reflect the functionality of this helper (rewriting requested URLs)
<tag>url_rewrite_concurrency</tag>Activates a new and more efficient helper protocol. Requires changes in the helper.
<tag>location_rewrite_*</tag>New helper hook for rewriting Location headers
<tag>auth_param basic blankpassword</tag>New option to allow the use of blank passwords.
<tag>auth_param basic/digest concurrency</tag>New option enabling a multiplexed helper protocol allowing the same helper to process multiple concurrent requests in an efficient manner. Requires support from the helper. (2.6.STABLE2 and later)
<tag>auth_param ntlm max_challenge_reuse / max_challenge_lifetime</tag>No longer supported
<tag>auth_param ntlm use_ntlm_negotiate</tag>Directive no longer supported. Use of NTLM negotiate packet is always on.
<tag>auth_param ntlm keep_alive</tag>New option to fine-tune the use of HTTP keep-alive in combination with NTLM
<tag>auth_param negotiate</tag>New Negotiate authentication scheme, the "next generation" scheme in the family of Microsoft authentication.
<tag>external_acl_type</tag>Many new format options %SRCPORT, %MYADDR, %MYPORT, %PATH, %USER_CERT, %ACL, %DATA and a few variants. Helper protocol defaults to the simpler "3.0" protocol, and there is support for a highly efficient protocol via the concurrency= option if supported by the helper.
<tag>refresh_pattern</tag>Several new HTTP override/ignore options
<tag>read_ahead_gap</tag>New directive to set the response buffer size.
<tag>collapsed_forwarding</tag>New directive to enable an alternative optimized forwarding path when there is very many concurrent requests for the same URL.
<tag>refresh_stale_hit</tag>New directive similar to collapsed_forwarding and activates an alternative optimized request processing when there is very many concurrent requests for the same recently expired URL.
<tag>acl urlgroup</tag>New acl class
<tag>acl user_cert</tag>New acl class matching the user SSL certificate (https_port)
<tag>acl ca_cert</tag>New acl class matching the CA of the user SSL certificate (https_port)
<tag>acl ext_user / ext_user_regex</tag>New acl matching usernames returned by external acl
<tag>follow_x_forwarded_for</tag>New option to enable parsing of X-Forwarded-For headers allowing access controls to be based on the real client IP even if behind secondary proxies
<tag>http_access2</tag>New http_access type directive but evaluated after url rewrites
<tag>htcp_access, htcp_clr_access</tag>Access control on HTCP requests
<tag>log_access</tag>New directive to limit what gets logged.
<tag>httpd_suppress_version_string</tag>Enable hiding of the Squid version
<tag>umask</tag>New directive to specify the minimum umask Squid should run under
<tag>error_map</tag>New directive to allow dynamic rewrites of error pages
<tag>via</tag>New directive to disable the use of the Via directive
<tag>wccp2_*</tag>WCCP2 protocol support
</descrip>

<sect>Known issues

<P>There is a few known issues in this version of Squid which we hope to correct in a later release

<descrip>
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=1590" name="#1590"></tag>"ETag Loop" warnings in cache.log
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=761" name="#761"></tag>assertion failed: cbdata.c:249: "c-&gt;locks &gt; 0" when using diskd
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=1640" name="#1640"></tag>unstable if mixing coss cache_dir type with other cache_dir types (ufs/aufs/diskd).
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=1602" name="#1602"></tag>Need to implement TCP fallback on truncated (large) DNS responses
</descrip>

<sect>Known limitations

<P>In addition there is a set of limitations in this version of Squid which we hope to correct later

<descrip>
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=1420" name="#1420"></tag>302 responses with an Expires header is always cached
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=1584" name="#1584"></tag>WCCPv2 unable to register with more than one router on Linux
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=1059" name="#1059"></tag>mime.conf and referenced icons must be within chroot
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=692" name="#692"></tag>tcp_outgoing_address using an ident ACL does not work
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=581" name="#581"></tag>acl max_user_ip and multiple authentication schemes
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=528" name="#528"></tag>miss_access fails on "slow" acl types such as dst.
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=513" name="#513"></tag>squid -F is starting server sockets to early
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=457" name="#457"></tag>does not handle swap.state corruption properly
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=410" name="#410"></tag>unstable if runs out of disk space
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=355" name="#355"></tag>diskd may appear slow on low loads
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=219" name="#219"></tag>delay_pools stops working on -k reconfigure
</descrip>

<sect>Other issues

<P>Ipfilter 4.x compile problem on HP Tru64
<itemize>
    <item>Running configure --enable-ipf-transparent on an HP Tru64 5.1B system with ipfilter 4.x installed, the following error can occur:
    <verb>
      checking if IP-Filter header files are installed... no
      WARNING: Cannot find necessary IP-Filter header files
               Transparent Proxy support WILL NOT be enabled</verb>
    To fix the problem first check if the ip_fil.h, ip_compat.h, ip_nat.h and ipl.h files are present in
    /usr/include/netinet and copy them from ipfilter source tree if needed.
    Don't forget to fix files permission and ownership after the copy.<newline>
    If the error still persist, run configure making it skip the ip_compat.h test:<newline>
    <verb>
    env ac_cv_header_netinet_ip_compat_h=yes ./configure --enable-ipf-transparent</verb>
    <item>On Sun Solaris 10, ipfilter 4.0.22 is provided with the OS, but related include files (ip_fil.h, ip_compat.h, ip_nat.h, ipl.h) are missing.<newline>
      Before running configure --enable-ipf-transparent, they must be downloaded from the
      <url url="http://cvs.opensolaris.org/source/xref/usr/src/common/ipf/" name="OpenSolaris Web Site">
      in the /usr/include local directory. Don't forget to fix files permission and ownership after the download.
</itemize>


<sect>Windows support
<P>This Squid version can run on Windows as a system service using the Cygwin environment.<newline>
Windows NT 4 and later are supported.<newline>
On Windows 2000/XP/2003 the service is configured to use the Windows Service Recovery option
restarting automatically after 60 seconds.
<descrip>

<tag>Usage</tag>

Some new command line options was added for the Windows service support:<newline>

The service installation is made with -i command line switch, it's possible to use -f switch at
the same time for specify a different config-file settings for the Squid Service that will be
stored on the Windows Registry.

A new -n switch specify the Windows Service Name, so multiple Squid instance are allowed.
<em/"Squid"/ is the default when the switch is not used.

So, to install the service, the syntax is: 

<verb>squid -i [-f file] [-n name]</verb>

Service uninstallation is made with -r command line switch with the appropriate -n switch.

The -k switch family must be used with the appropriate -f and -n switches, so the syntax is: 

<verb>squid -k command [-f file] -n service-name</verb>
where <em/service-name/ is the name specified with -n options at service install time.

To use the Squid original command line, the new -O switch must be used ONCE, the syntax is: 

<verb>squid -O cmdline [-n service-name]</verb>
If multiple service command line options must be specified, use quote. The -n switch is
needed only when a non default service name is in use.

Don't use the "Start parameters" in the Windows 2000/XP/2003 Service applet: they are
specific to Windows services functionality and Squid is not designed for understand they.

In the following example the command line of the "squidsvc" Squid service is set to "-D -u 3130": 

<verb>squid -O "-D -u 3130" -n squidsvc</verb>
</descrip>

<descrip>
<tag>Registry DNS lookup</tag>
On Windows platforms, if no value is specified in the <em/dns_nameservers/ option on
squid.conf or in the /etc/resolv.conf file, the list of DNS name servers are
taken from the Windows registry, both static and dynamic DHCP configurations
are supported.
</descrip>

<descrip>
<tag>Compatibility Notes</tag>
<itemize>
<item>It's recommended to use '/' char in Squid paths instead of '\'
<item>Paths with spaces (like 'C:\Programs Files\Squid) are NOT supported by Squid
<item>When using ACL like 'acl aclname acltype "file"' the file must be in DOS text
format (CR+LF) and the full Windows path must be specified, for example:

<verb>acl blocklist url_regex -i "c:/squid/etc/blocked1.txt"</verb>

<item>The Windows equivalent of '/dev/null' is 'NUL'
<item>Squid doesn't know how to run external helpers based on scripts, like .bat, .cmd,
.vbs, .pl, etc. So in squid.conf the interpreter path must be always specified, for example:

<verb>redirect_program c:/perl/bin/perl.exe c:/squid/libexec/redir.pl
redirect_program c:/winnt/system32/cmd.exe /C c:/squid/libexec/redir.cmd</verb>
<item>When Squid runs in command line mode, the launching user account must have administrative privilege on the system
<item>"Start parameters" in the Windows 2000/XP/2003 Service applet cannot be used
</itemize>
</descrip>

<descrip>
<tag>Known Limitations:</tag>
<itemize>
<item>Squid features not operational:<newline>
<itemize>
<item>DISKD: still needs to be ported<newline>
<item>WCCP: cannot work because user space GRE support on Windows is missing<newline>
<item>Transparent Proxy: missing Windows non commercial interception driver<newline>
</itemize>
<item>Some code sections can make blocking calls.
<item>Some external helpers may not work.
</itemize>
</descrip>


<sect>Key changes squid-2.6.STABLE1 to 2.6.STABLE2:

<p>
<itemize>
        <item>Bug #1650: transparent interception "Unable to forward this request at this time"
	<item>Bug #1658: Memory corruption when using client-side SSL certificates
	<item>COSS fixes
	<item>Added the missing concurrency parameter to basic/digest auth schemes
	<item>Bug #1669: SEGV in storeAddVaryReadOld
	<item>a number of other minor and cosmetic bugfixes. See the list of <url
		url="http://www.squid-cache.org/Versions/v2/2.6/changesets/"
			name="squid-2.6 changes"> and the <url url="ChangeLog"
				name="ChangeLog"> file for details.
</itemize>



</article>

