<!doctype linuxdoc system>
<article>
<title>Squid 2.5 release notes</title>
<author>Squid Developers</author>
<date>$Id$</date>

<abstract>
This document contains the release notes for version 2.5 of Squid.
Squid is a WWW Cache application developed by the National Laboratory
for Applied Network Research and members of the Web Caching community.
</abstract>

<toc>

<sect>Key changes from squid 2.4:
<p>
<itemize>
        <item>Major rewrite of proxy authentication to support other schemes
          than basic. First in the line is NTLM support but others can
          easily be added (minimal digest is present). See the Programmers
          Guide for the internals.
          Thanks to the SAMBA team for some excellent collaboration on the
          NTLM support!
          (Robert Collins & Francesco Chemolli)
        <item>Optimized searching in proxy_auth and ident ACL types. Squid
          should now handle large access lists a lot more efficiently.
          (Francesco Chemolli)
        <item>Fixed forwarding/peer loop detection code (Brian Degenhardt) -
          now a peer is ignored if it turns out to be us, rather than
          committing suicide
        <item>Changed the internal URL code to obey appendDomain for
          internal objects if it needs appending. This fixes weirdnesses
          where a machine can think it is "foo.bar.com", and "foo" is
          requested.
          (Brian Degenhardt)
        <item>Added the use of Automake to create the Makefile.in's in the
          squid source tree. This will allow libtool in the future, and
          immediately allows better dependency tracking - with or 
          without gcc - as well as the dist-all and distcheck targets
          for developers which respectively build a tar.gz and a tar.bz2
          distribution, and check that what will be distributed builds.
          (Robert Collins)
        <item>Added TOS and source address selection based on ACLs,
          written by Roger Venning. This allows administrators to set
          the TOS precedence bits and/or the source IP from a set of
          available IPs based upon some ACLs, generally to map different
          users to different outgoing links and traffic profiles.
        <item>Added 'max-conn' option to 'cache_peer'
        <item>Added SSL gatewaying support, allowing Squid to act as a SSL
          server in accelerator setups.
        <item>Many new authentication helpers.
        <item>no_cache now applies to cache hits as well as cache misses
        <item>the Gopher client in Squid has been significantly improved
        <item>Squid now sanity checks FTP data connections to ensure the
          connection is from the requested server. Can be disabled if
          needed by turning off the ftp_sanitycheck option.
        <item>external acl support. A mechanism where flexible ACL checks
          can be driven by external helpers. See the external_acl_type
          and acl external directives. (MARA Systems AB)
        <item>Countless other small things and fixes
        <item>HTML pages generated by Squid or CacheMgr as well as the
          ERR documents now contain a doctype declaration so that
          browsers know which HTML specification the document uses.
          In addition to that they have a new look
          (background-color, font) and are valid according to the HTML
          standards at www.w3.org.
          (Clemens Löser)
        <item>Login and password send to Basic auth helpers is now URL
          escaped to allow for spaces and other "odd" characters in
          logins and passwords
	<item>Proxy Authentication is no longer blindly forwarded to peer
	  caches if not used locally. If forwarding of proxy authentication
	  is desired then it must now be configured with the login=PASS
	  cache_peer option.
        <item>Responses with Vary: in the header are now cached by squid.
          (Henrik Nordstrom).
	<item>Support for openBSD pf interface in interception mode.
	<item>It is now possible to send complex arguments to helpers
	by quoting the arguments by " and/or \ 
	<item>The directory structure has changed slightly. The squid binary
	has been moved into sbin, errors and icons into share/, and the libexec
	programs are now in libexec/ (was previously libexec/squid/). See
	configure --help for instructions on how to move these around to
	exacly where you want to have them in your system.
</itemize>

<sect>Changes to squid.conf
<p><descrip>
<tag>http_port</tag>Allows ip address specification.
<tag>https_port</tag>This is an option for use with SSL acceleration - it determines where squid listens for SSL requests.
<tag>ssl_unclean_shutdown</tag>This is used to handle some bugs in browsers that don't fully support SSL.
<tag>tcp_incoming_address</tag>This has been removed - use the http_port line to specify ip address's.
<tag>cache_peer</tag>login= has been extended to allow pass through authentication, fixed password authentication and maximum connection limits.
<tag>hosts_file</tag>Directs squid to read in a set of name-address associations upon startup and reconfiguration.
<tag>authenticate_program</tag><p><tag>authenticate_children</tag><p><tag>proxy_auth_realm</tag>Removed. See auth_param.
<tag>auth_param</tag>This replaces the authenticate_program directive. It allows configuration of multiple authentication helpers, one for each of the supported authentication schemes. Such schemes include "NTLM", "Digest (from RFC 2617)", and "Basic".
<tag>authenticate_cache_garbage_interval</tag>This directive sets the garbage collection interval for the authentication cache.
<tag>external_acl_type</tag>This directive configures the new external ACL Helper interface. VERY useful for authenticating by group membership - i.e. from an LDAP server or NT domain.
<tag>request_body_max_size</tag>The default for this is now 0 - unlimited.
<tag>reply_body_max_size</tag>Now multiple size limits are allowed based on ACL lists.
<tag>refresh_pattern</tag>The default is now blank - users must uncomment the suggested default to use it. This allows the use of a blank refresh pattern if desired.
<tag>request_timeout</tag>Raised the default to 5 minutes.
<tag>persistent_request_timeout</tag> New directive - how long to wait after a reply is completed before closing the connection.
<tag>acl</tag>New acl types<itemize><item>referer_regex (match Referer headers),
<item>max_user_ip (limit concurrent IP's a single user may use)
<item>rep_mime_type (filter replies based on their content type).
<item>external (use an external helper)</itemize>
<tag>http_reply_access</tag>Limit HTTP replies based on ACL's. This is complementary to http_access.
<tag>tcp_outgoing_tos</tag><p><tag>tcp_outgoing_ds</tag><p><tag>tcp_outgoing_dscp</tag>These three directives allow marking of outbound connections at the IP level - i.e. for choosing routes based on the usercode.
<tag>tcp_outgoing_address</tag>Allows mapping of requests onto specific outbound IP address's.
<tag>anonymize_headers</tag>Removed. See header_access.
<tag>header_access</tag>Allow granular filtering of HTTP headers.
<tag>header_replace</tag>Replace specific headers with custom values.
<tag>pipeline_prefetch</tag>Now defaults to off for bandwidth management and access logging reasons.
<tag>vary_ignore_expire</tag>Enables a workaround for web servers that immediately expire Varied objects because they think squid is unable to handle Vary:.
<tag>sleep_after_fork</tag>Give the OS a small amount of time to accomodate the fork+exec used to launch helpers - if squid has a lot of virtual memory allocated the OS may run out of virtual memory during helper spawning otherwise.
<tag>reference_age</tag>This has been removed - starting with Squid-2.4 this directive have had no effect and has now been fully removed to avoid confusion.
<tag>siteselect_timeout</tag>This has been removed - it is not referenced anywhere in the source code.
<tag>minimum_retry_timeout</tag>This has been removed - it is not referenced anywhere in the source code.
<tag>forward_timeout</tag>New directive in 2.5.STABLE5 complement connect_timeout in
management of timeouts while connecting to origin servers or peers
<tag>short_icon_urls</tag>New directive in 2.5.STABLE5 to enable an alternative way of referring to icons in FTP directory listings etc.
<tag>acl urllogin</tag>New acl type in 2.5.STABLE5 to match the login component of Internet style URLs (protocol://user:password@host/path/to/file)
<tag>balance_on_multiple_ip</tag>New directive in 2.5.STABLE7 to make it possible to disable the automatic round-robin load balancing on multiple IP addresses normally done by Squid.
<tag>reply_header_max_size</tag>New directive in 2.5.STABLE7 limiting the size of HTTP reply headers, similar to request_header_max_size but in the reply direction (from servers to clients). Default is 20KB.
<tag>acl req_hdr/resp_hdr</tag>New acl types in 2.5.STABLE7 to match arbitrary HTTP headers, useful to block certain malware/spyware etc.
<tag>relaxed_http_parser</tag>New directive in 2.5.STABLE8 to control how strict the HTTP parser should be.
<tag>retry_on_error</tag>New directive in 2.5.STABLE9 to aggressive retry requests on errors (was the default in earlier versions)
</descrip>

<sect>Known issues and limitations

<P>There is a few known issues and limitations in this version of Squid which we hope to correct in a later release

<descrip>
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=761" name="#761"></tag>assertion failed: cbdata.c:249: "c-&gt;locks &gt; 0" when using diskd
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=1193" name="#1193"></tag>Interception fails if intercepting multiple ports and Squid is not listening on the same ports
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=1094" name="#1094"></tag>cachemgr.cgi should have a built-in access control layer to prevent malicious use
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=649" name="#649"></tag>Problems refreshing pages stored with 'vary' information
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=779" name="#779"></tag>users going above their allowed IP count no longer logged in cache.log
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=1204" name="#1204"></tag>FTP listings uses "BASE HREF" much more than it needs to
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=888" name="#888"></tag>ntlm_user_pool assertion error on shutdown
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=1223" name="#1223"></tag>Authentication could be more informative on why a login failed
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=1227" name="#1227"></tag>Syslog facility should not be hardcoded to "local4"
</descrip>


<P>In addition there is a set of limitations in this version of Squid which we hope to correct later

<descrip>
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=1059" name="#1059"></tag>mime.conf and referenced icons must be within chroot
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=1033" name="#1033"></tag>CARP ignores cache_peer_access and cache_peer_domain
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=692" name="#692"></tag>tcp_outgoing_address using an ident ACL does not work
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=581" name="#581"></tag>acl max_user_ip and multiple authentication schemes
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=528" name="#528"></tag>miss_access fails on "slow" acl types such as dst.
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=513" name="#513"></tag>squid -F is starting server sockets to early
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=518" name="#518"></tag>wb_auth fails on TRU64 and probably other 64 bit platforms
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=500" name="#500"></tag>delay_pools stops working on -k reconfigure
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=457" name="#457"></tag>does not handle swap.state corruption properly
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=410" name="#410"></tag>unstable if runs out of disk space
<tag>Bug <url url="http://www.squid-cache.org/bugs/show_bug.cgi?id=355" name="#355"></tag>diskd may appear slow on low loads
</descrip>

<sect>Key changes squid-2.5.STABLE1 to 2.5.STABLE2:

<p>
<itemize>
	<item>authentication now works in most access directives if
	first enforced in http_access
	<item>contrib files included in the distribution again
	<item>aufs bugfixes to address both stability and data
	corruption issues, and some aufs performance improvements.
	<item>now possible to specify acl values with spaces in them
	via the "include file" technique
	<item>winbind helpers updated to match Samba-2.2.7a and should
	work with Samba-2.2.6 or later (required). For compatibility with
	older Samba versions A new configure option --with-samba-sources=...
	has been added to allow you to specify which Samba version the
	helpers should be built for if different than the above versions.
	<item>squid_ldap_group updated to correctly handle LDAP groups
	<item>new experimental configure option --disable-hostname-checks to make Squid not validate that received hostnames are valid for use within HTTP. Required to participate in testbeds for international domain names etc.
	<item>several assertion or segmentation faults corrected
	<item>a large number of minor bugfixes. See the list of <url
	url="http://www.squid-cache.org/Versions/v2/2.5/bugs/#STABLE1"
	name="squid-2.5.STABLE1 patches"> and the <url url="ChangeLog"
	name="ChangeLog"> file for details.
</itemize>

<sect>Key changes squid-2.5.STABLE2 to 2.5.STABLE3:

<p>
<itemize>
	<item>a large number of minor bug fixes. See the list of <url
url="http://www.squid-cache.org/Versions/v2/2.5/bugs/#STABLE2"
name="squid-2.5.STABLE2 patches"> and the <url url="ChangeLog"
name="ChangeLog"> file for details.
</itemize>

<sect>Key changes squid-2.5.STABLE3 to 2.5.STABLE4:

<p>
<itemize>
	<item>several memory leaks corrected
	<item>segmentation fault if more than one deny_info corrected
	<item>Lithuanian error messages added
	<item>a crash related to ftpTimeout: timeout in SENT_PASV state corrected
	<item>http_reply_access deny now logs the request with
	TCP_DENIED to allow them to be accounted for properly in statistics
	<item>minimum_retry_timeout configuration directive removed. If
	you have this directive in your existing squid.conf you will
	need to remove the line. 
	<item>Improvements to the (experimental) COSS storage scheme.
	<item>Updates to allow Squid to be compiled with GCC-3.3
	<item>POST now works well with NTLM and Digest authentication
	<item>http_header_access now works in combination with cache_peer
	<item>Most Squid generated errors are now logged as TCP_DENIED/XXX
	rather than TCP_MISS/XXX or NONE/XXX. This to work around issues
	relating to access controls.
	<item>external_acl_type concurrency= option renamed to children=
	to prepare for Squid-3 upgrade. The old syntax is still accepted
	but you may want to upgrade your configuration now to save you
	from the trouble when upgrading to Squid-3 later.
	<item>a large number of minor bugfixes. See the list of <url
	url="http://www.squid-cache.org/Versions/v2/2.5/bugs/#STABLE3"
	name="squid-2.5.STABLE3 patches"> and the <url url="ChangeLog"
	name="ChangeLog"> file for details.
</itemize>

<sect>Key changes squid-2.5.STABLE4 to 2.5.STABLE5:

<p>
<itemize>
	<item>redirector interface modified to try to deal with login names
	containing spaces or other odd characters. This is accomplished
	by URL-encoding the login name before sent to redirectors. Note:
       	Existing redirectors or their configuration may need to be slightly
       	modified in how they process the ident column to support the new
	username format (only applies to redirectors looking into the username)
	<item>new forward_timeout option to complement connect_timeout in
	management of timeouts while connecting to origin servers or peers
	<item>various timeouts adjusted: connect_timeout 1 minute (was 2 minutes
	which is now forward_timeout), negative_dns_ttl 1 minute (was 5 minutes)
	and is now also used as minimum positive dns ttl, dns_timeout 2 minutes
	(was 5 minutes)
	<item>"short_icon_urls on" can be used to simplify the URLs used for
	icons etc to avoid issues with proxy host naming and authentication
	when requesting icons.
	<item>A new "urllogin" ACL type has been introducing allowing regex
	matches to the "login" component of Internet style URLs
	(protocol://user:password@host/path/to/file).
	<item>Squid now respects the Telnet protocol on connections to FTP
	servers. The ftp_telnet_protocol directive can be used to revert back
	to the old incorrect implementation.
	<item>Several NTLM related bugfixes and improvements fixing the problem
	of random auth popups and account lockouts. Support for the NEGOTIATE
	NTLM packet is also added to allow Samba-3.0.2 or later to negotiate the
	use of NTLMv2.
	<item>Several authentication related bugfixes to allow authentication
	to work in additional acl driven directives, correct an number
	of assertion or segmentation and some memory leaks.
	<item>The default mime.conf has been updated with many new mime types
	and a few minor corrections. In addition the download and view links
	is used more frequently to allow view/download of different ftp://
	contents regardless of their mime type assignment.
	<item>url_regex enhanced to allow matching of %00
	<item>a large number of minor and cosmetic bugfixes. See the list of <url
	url="http://www.squid-cache.org/Versions/v2/2.5/bugs/#STABLE4"
	name="squid-2.5.STABLE4 patches"> and the <url url="ChangeLog"
	name="ChangeLog"> file for details.
</itemize>

<sect>Key changes squid-2.5.STABLE5 to 2.5.STABLE6:

<P>
<itemize>
	<item>Several "Assertion error" bugs fixed
	<item>Several "Segmentation fault" bugs fixes
	<item>Corrects a security issue in the old ntlm_auth NTLM helper
	    used in transparent NTLM authentication to a NT domain without
	      using samba.
	<item>Processing of Vary: * and Vary on error messages corrected
	<item>a large number of minor and cosmetic bugfixes. See the list of <url
	url="http://www.squid-cache.org/Versions/v2/2.5/bugs/#STABLE5"
	name="squid-2.5.STABLE5 patches"> and the <url url="ChangeLog"
	name="ChangeLog"> file for details.
</itemize>
	
<sect>Key changes squid-2.5.STABLE6 to 2.5.STABLE7:

<P>
<itemize>
	<item>SNMP related Denial of Service issue corrected (CAN-2004-0918)
	<item>NTLM related bugfix noticed by the Samba group
	<item>UFS cache_dir bugfix to issue introduced in STABLE6 causing
	no objects to get cached in some configurations.
	<item>cache_effective_user now sets supplementary group list
	if cache_effective_group not set
	<item>cache_effective_group now used if specified even if not started
	as root. If you do not start Squid as root you may need to remove this
	directive from your squid.conf if not set correctly.
	<item>request_header_max_size directive corrected. You may need to increase
	this value after upgrading if set very low. The default have been increased
	from 10 KB to 20 KB which should be sufficient for most uses.
	<item>reply_header_max_size directive added
	<item>http_header_access &amp; replace now support arbitrary headers,
	not only the well known headers known by Squid
	<item>new acl types req_hdr and resp_hdr to match arbitrary HTTP headers,
	useful to block certain malware/spyware etc.
	<item>new balance_on_multiple_ip squid.conf directive
	<item>a number of other minor and cosmetic bugfixes. See the list of <url
	url="http://www.squid-cache.org/Versions/v2/2.5/bugs/#STABLE6"
	name="squid-2.5.STABLE6 patches"> and the <url url="ChangeLog"
	name="ChangeLog"> file for details.
</itemize>
	
<sect>Key changes squid-2.5.STABLE7 to 2.5.STABLE8:

<p>
<itemize>
	<item>Squid no longer closes all open filedescriptors. Previous Squid
	versions have for increased security closed any open filedescriptors left
	open by the process starting Squid, but this is not really our business
	and causes problems for certain libraries opening internal filedescriptors
	in some conditions (some SSL libraries, syslog, DNS resolver etc).
	<item>Configuration parser made more strict and consistent. Previously empty acl
	declarations were ignored in http_access causing some unexpected results.
	Now empty acl declarations are allowed (matching nothing) and http_access
	requires all listed acls to be defined.
	<item>A minor information leak in error messages due to malformed host
	names corrected
	<item>Several HTTP security fixes to prevent cache pollution attacks or theft
	of user confidential information. New relaxed_http_parser directive to control
	how strict the HTTP parser should be.
	<item>Buffer overflow fix in gopherToHTML.
	<item>Corrected a Segmentation fault on malformed WCCP packets.
	<item>squid_ldap_auth now sanity checks usernames
	<item>Corrected a Segmentation fault and other malfunctions on failed PUT/POST
	requests.
	<item>Properly handle oversized reply headers
	<item>a number of other minor and cosmetic bugfixes. See the list of <url
	url="http://www.squid-cache.org/Versions/v2/2.5/bugs/#STABLE7"
	name="squid-2.5.STABLE7 patches"> and the <url url="ChangeLog"
	name="ChangeLog"> file for details.
</itemize>

<sect>Key changes squid-2.5.STABLE8 to 2.5.STABLE9:

<p>
<itemize>
	<item>DNS related assertion error
	<item>High characters allowed in FTP &amp; Gopher listings.
	<item>Additional workarounds for broken web servers rejected by 2.5.STABLE8.
	<item>No longer automatically retries requests on 403 Access Denied or
	many other server errors. New squid.conf directive retry_on_error to revert
	back to the old behavior if needed.
	<item>a number of other minor and cosmetic bugfixes. See the list of <url
	url="http://www.squid-cache.org/Versions/v2/2.5/bugs/#STABLE8"
	name="squid-2.5.STABLE8 patches"> and the <url url="ChangeLog"
	name="ChangeLog"> file for details.
</itemize>

<sect>Key changes squid-2.5.STABLE9 to 2.5.STABLE10:

<p>
<itemize>
	<item>Fixed a Set-Cookie race condition causing inconsistent cache
       	behaviour
	<item>Abort on misconfigured http_access rules to prevent unexpected
	results from partial configuration
	<item>FTP directory listings corrected again (broken by 2.5.STABLE9)
	<item>Support for proxying huge objects greater than 2GB in size
	<item>IP-Filter 4.0 support in --enable-ipf-transparent
	<item>cachemgr.cgi now uses a configuration controlling which servers
	may be managed. This to prevent abuse of the program. See <tt>&gt;prefix&lt/etc/cachemgr.conf</tt>
	for details. The configuration is read first from the current directory
	(normally where you installed cachemgr.cgi) and if not found there from
	<tt>&gt;prefix&lt;/etc/cachemgr.conf</tt>. If neither is found only access
	to localhost and the full server name is provided, or the cachemgr default
	host if specified to configure.
	<item>a number of other minor and cosmetic bugfixes. See the list of <url
	url="http://www.squid-cache.org/Versions/v2/2.5/bugs/#STABLE9"
	name="squid-2.5.STABLE9 patches"> and the <url url="ChangeLog"
	name="ChangeLog"> file for details.
</itemize>

</article>

