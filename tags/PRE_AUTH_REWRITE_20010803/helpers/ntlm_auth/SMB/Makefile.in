#
#  Makefile for the Squid Object Cache server
#
#  $Id$
#
#  Uncomment and customize the following to suit your needs:
#

prefix		= @prefix@
exec_prefix	= @exec_prefix@
exec_suffix	= @exec_suffix@
top_srcdir	= @top_srcdir@
libexecdir		= @libexecdir@
srcdir		= @srcdir@
VPATH		= @srcdir@

# Gotta love the DOS legacy
#
NTLM_AUTH_EXE	= ntlm_auth$(exec_suffix)

CC		= @CC@
MAKEDEPEND	= @MAKEDEPEND@
INSTALL		= @INSTALL@
INSTALL_BIN	= @INSTALL_PROGRAM@
CRYPTLIB	= @CRYPTLIB@
AC_CFLAGS	= @CFLAGS@
LDFLAGS		= @LDFLAGS@
XTRA_LIBS	= @XTRA_LIBS@
XTRA_OBJS	= @XTRA_OBJS@
MV		= @MV@
RM		= @RM@
SHELL		= /bin/sh


INCLUDE		= -I. -I../../../../../include -I$(srcdir)/smbval -I$(top_srcdir)/include
CFLAGS		= $(AC_CFLAGS) $(INCLUDE) $(DEFINES)
AUTH_LIBS	= -L../../../../../lib -lntlmauth -lmiscutil $(CRYPTLIB) $(XTRA_LIBS)

LIBPROGS	= $(NTLM_AUTH_EXE)
OBJS		= ntlm_auth.o libntlmssp.o

all:	$(NTLM_AUTH_EXE)  smbval/smbvalid.a

$(OBJS): $(top_srcdir)/include/version.h ntlm.h

$(NTLM_AUTH_EXE): $(OBJS) smbval/smbvalid.a 
	$(CC) $(LDFLAGS) $(OBJS) smbval/smbvalid.a -o $@ $(AUTH_LIBS)

smbval/smbvalid.a: smbval/stamp

smbval smbval/stamp:
	@sh -c "cd smbval && $(MAKE) all"

install-mkdirs:
	-@if test ! -d $(prefix); then \
		echo "mkdir $(prefix)"; \
		mkdir -p $(prefix); \
	fi
	-@if test ! -d $(libexecdir); then \
		echo "mkdir $(libexecdir)"; \
		mkdir -p $(libexecdir); \
	fi

install: all install-mkdirs
	@for f in $(LIBPROGS); do \
		if test -f $(libexecdir)/$$f; then \
			echo $(MV) $(libexecdir)/$$f $(libexecdir)/-$$f; \
			$(MV) $(libexecdir)/$$f $(libexecdir)/-$$f; \
		fi; \
		echo $(INSTALL_BIN) $$f $(libexecdir); \
		$(INSTALL_BIN) $$f $(libexecdir); \
		if test -f $(libexecdir)/-$$f; then \
			echo $(RM) -f $(libexecdir)/-$$f; \
			$(RM) -f $(libexecdir)/-$$f; \
		fi; \
	done

clean:
	-rm -rf *.o *pure_* core $(LIBPROGS)
	cd smbval; make clean

distclean:     clean
	-rm -f Makefile

depend:
	$(MAKEDEPEND) -I../include -I. -fMakefile *.c
